import{d as y,R as C,b6 as c,r as h,an as T,cB as m,S as O,L as x,Z as N,P as r,O as l,T as w,Q as a,aI as n,aJ as u,aX as k,aY as U,$ as q,U as B,cC as F,aH as M,W as R,Y as S,cx as p}from"./index-f3276eeb.js";import{b as I}from"./index-f72eace5.js";import{a as A}from"./headers-555dcb01.js";const H=y({__name:"forgetPassword",setup(K){const f=I("(max-width: 768px)"),P=C(),i=c(),t=h({data:{email:"",newPassword:"",newPasswordConfirm:"",OTP:""},loading:{submit:!1},disabled:{submit:!0}}),v={email:[{required:!0,message:"請輸入帳號",trigger:["input","blur"]},{validator:(s,e)=>m.email.test(e),message:"請輸入有效的電子信箱格式",trigger:["blur"]}],newPassword:[{required:!0,message:"請輸入密碼",trigger:["input","blur"]},{required:!0,validator:(s,e)=>e.length>=8,message:"密碼長度至少8個字",trigger:["input","blur"]}],newPasswordConfirm:[{required:!0,validator:(s,e)=>e===t.value.data.newPassword,message:"密碼不一致",trigger:["input","blur"]}]};T(t.value.data,s=>{const e=s.email&&s.newPassword&&s.newPasswordConfirm&&s.newPassword===s.newPasswordConfirm&&s.OTP&&m.email.test(s.email);t.value.disabled.submit=!e});const{mutate:b,isPending:g}=O({mutationFn:async()=>await R.changePasswordWithOTP.api({email:t.value.data.email,newPassword:t.value.data.newPassword,newPasswordConfirm:t.value.data.newPasswordConfirm,OTP:t.value.data.OTP}),onSuccess:async s=>{var e,o,d;if(((e=s==null?void 0:s.response)==null?void 0:e.status)===400||((o=s==null?void 0:s.response)==null?void 0:o.status)===401||((d=s==null?void 0:s.response)==null?void 0:d.status)===404){i.error({content:"輸入錯誤"}),t.value.data.OTP="",t.value.data.newPassword="",t.value.data.newPasswordConfirm="";return}i.success({content:"密碼重置成功"}),P.push(S.login)}});return(s,e)=>(x(),N("div",null,[r(a(A),null,{default:l(()=>e[6]||(e[6]=[w(" 忘記密碼 ")])),_:1}),r(a(M),{ref:"formRef","label-width":80,model:a(t).data,rules:v,style:F({width:a(f)?"100%":"400px"})},{default:l(()=>[r(a(n),{path:"email",label:"電子信箱"},{default:l(()=>[r(a(u),{value:a(t).data.email,"onUpdate:value":e[0]||(e[0]=o=>a(t).data.email=o),placeholder:"請輸入電子信箱",onKeydown:e[1]||(e[1]=k(U(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1},8,["path"]),r(a(n),{path:"newPassword",label:"新密碼"},{default:l(()=>[r(a(u),{value:a(t).data.newPassword,"onUpdate:value":e[2]||(e[2]=o=>a(t).data.newPassword=o),type:"password",placeholder:"請輸入新密碼"},null,8,["value"])]),_:1},8,["path"]),r(a(n),{path:"newPasswordConfirm",label:"確認新密碼"},{default:l(()=>[r(a(u),{value:a(t).data.newPasswordConfirm,"onUpdate:value":e[3]||(e[3]=o=>a(t).data.newPasswordConfirm=o),type:"password",placeholder:"請輸入確認新密碼"},null,8,["value"])]),_:1},8,["path"]),r(a(n),{path:"OTP",label:"驗證碼",class:"mb-20"},{default:l(()=>[r(a(u),{value:a(t).data.OTP,"onUpdate:value":e[4]||(e[4]=o=>a(t).data.OTP=o),type:"password",placeholder:"請輸入驗證碼"},null,8,["value"])]),_:1},8,["path"]),r(a(q),{justify:"space-between",align:"baseline"},{default:l(()=>[r(a(B),{round:"",type:"primary",disabled:a(t).disabled.submit,loading:a(g),onClick:e[5]||(e[5]=o=>a(b)())},{default:l(()=>e[7]||(e[7]=[w(" 確認 ")])),_:1},8,["disabled","loading"])]),_:1})]),_:1},8,["model","style"])]))}});typeof p=="function"&&p(H);export{H as default};
