import{u as V}from"./useQuery-3f218866.js";import{d as k,L as y,Z as B,aq as _,aW as A,r as C,S as M,an as S,P as t,O as r,T as i,Q as e,U as N,aN as E,aO as $,aH as q,aI as f,aJ as c,aX as g,aY as P,R as I,M as z,aG as D,aZ as j,ap as h,$ as O,_ as R,a3 as H}from"./index-9d67ad35.js";import{u as v}from"./useUserApi-b1ae207c.js";import{u as G}from"./use-message-49f75ddf.js";import{N as J,a as Q}from"./DrawerContent-eb959d3c.js";import{N as Z}from"./headers-be49c173.js";import{N as F}from"./text-f9890e7d.js";import{N as K}from"./Flex-c57557da.js";const L={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},W=_("rect",{x:"48",y:"96",width:"416",height:"320",rx:"40",ry:"40",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),X=_("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M112 160l144 112l144-112"},null,-1),Y=[W,X],ee=k({name:"MailOutline",render:function(w,u){return y(),B("svg",L,Y)}}),ae={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},se=_("path",{d:"M344 144c-3.92 52.87-44 96-88 96s-84.15-43.12-88-96c-4-55 35-96 88-96s92 42 88 96z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),te=_("path",{d:"M256 304c-87 0-175.3 48-191.64 138.6C62.39 453.52 68.57 464 80 464h352c11.44 0 17.62-10.48 15.65-21.4C431.3 352 343 304 256 304z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),re=[se,te],ne=k({name:"PersonOutline",render:function(w,u){return y(),B("svg",ae,re)}}),{Axios:ge,AxiosError:oe,CanceledError:Pe,isCancel:he,CancelToken:Ne,VERSION:ve,all:ke,Cancel:ye,isAxiosError:_e,spread:xe,toFormData:be,AxiosHeaders:Ce,HttpStatusCode:Be,formToJSON:Ue,getAdapter:Me,mergeConfig:Se}=A,de=k({__name:"UpdateProfileBtnComponent",setup(x){const w=C(null),u=C(null),b=G(),s=C({data:{changePassword:{currentPassword:"",newPassword:"",reenteredNewPassword:""},changeName:{name:""}},status:{drawer:!1},disabled:{updatePasswordBtn:!0,updateNameBtn:!0}}),p={currentPassword:[{required:!0,message:"Password is required"}],newPassword:[{required:!0,message:"新密碼是必填的",trigger:["input","blur"]}],reenteredNewPassword:[{required:!0,message:"確認新密碼是必填的",trigger:["input","blur"]},{message:"新密碼與確認新密碼不一致!",trigger:["input","blur"],validator:()=>s.value.data.changePassword.newPassword===s.value.data.changePassword.reenteredNewPassword}]},{mutate:m,isPending:o}=M({mutationFn:async()=>await v.updatePassword.api({oldPassword:s.value.data.changePassword.currentPassword,newPassword:s.value.data.changePassword.newPassword}),onSuccess:async d=>{var a,n,U;if(d.msg==="Sucess! Password Updated"){b.success("更新密碼成功");return}d instanceof oe&&(((a=d.response)==null?void 0:a.status)===400||((n=d.response)==null?void 0:n.status)===403||((U=d.response)==null?void 0:U.status)===401)&&b.error("更新密碼失敗")}});S(s.value.data.changePassword,()=>{const{data:d}=s.value,a=!!(d.changePassword.currentPassword&&d.changePassword.newPassword&&d.changePassword.reenteredNewPassword&&d.changePassword.reenteredNewPassword===d.changePassword.newPassword);s.value.disabled.updatePasswordBtn=!a});const{mutate:l,isPending:T}=M({mutationFn:async()=>await v.editUserInfo.api({name:s.value.data.changeName.name})});return S(s.value.data.changeName,()=>{const{data:d}=s.value,a=!!d.changeName.name;s.value.disabled.updateNameBtn=!a}),(d,a)=>(y(),B("div",null,[t(e(N),{type:"primary",strong:"",block:"",onClick:a[0]||(a[0]=n=>e(s).status.drawer=!0)},{default:r(()=>a[12]||(a[12]=[i(" 編輯個人資料 ")])),_:1}),t(e(Q),{show:e(s).status.drawer,"onUpdate:show":a[11]||(a[11]=n=>e(s).status.drawer=n),width:502,height:500,placement:"bottom"},{default:r(()=>[t(e(J),{title:"Stoner"},{default:r(()=>[t(e(E),{type:"segment",animated:""},{default:r(()=>[t(e($),{name:"profile",tab:"更改個人資料"},{default:r(()=>[t(e(q),{ref_key:"nameRef",ref:u,model:e(s).data.changeName},{default:r(()=>[t(e(f),{path:"name",label:"姓名"},{default:r(()=>[t(e(c),{value:e(s).data.changeName.name,"onUpdate:value":a[1]||(a[1]=n=>e(s).data.changeName.name=n),type:"text",onKeydown:a[2]||(a[2]=g(P(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1})]),_:1},8,["model"]),t(e(N),{round:"",type:"primary",loading:e(T),disabled:e(s).disabled.updateNameBtn,onClick:a[3]||(a[3]=n=>e(l)())},{default:r(()=>a[13]||(a[13]=[i(" 更新姓名 ")])),_:1},8,["loading","disabled"])]),_:1}),t(e($),{name:"password",tab:"更改密碼"},{default:r(()=>[t(e(q),{ref_key:"formRef",ref:w,model:e(s).data.changePassword,rules:p},{default:r(()=>[t(e(f),{path:"currentPassword",label:"現在密碼"},{default:r(()=>[t(e(c),{value:e(s).data.changePassword.currentPassword,"onUpdate:value":a[4]||(a[4]=n=>e(s).data.changePassword.currentPassword=n),type:"password","show-password-on":"click",onKeydown:a[5]||(a[5]=g(P(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1},8,["path"]),t(e(f),{path:"newPassword",label:"新密碼"},{default:r(()=>[t(e(c),{value:e(s).data.changePassword.newPassword,"onUpdate:value":a[6]||(a[6]=n=>e(s).data.changePassword.newPassword=n),type:"password","show-password-on":"click",onKeydown:a[7]||(a[7]=g(P(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1},8,["path"]),t(e(f),{path:"reenteredNewPassword",label:"確認新密碼"},{default:r(()=>[t(e(c),{value:e(s).data.changePassword.reenteredNewPassword,"onUpdate:value":a[8]||(a[8]=n=>e(s).data.changePassword.reenteredNewPassword=n),type:"password","show-password-on":"click",onKeydown:a[9]||(a[9]=g(P(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1},8,["path"]),t(e(N),{round:"",type:"primary",disabled:e(s).disabled.updatePasswordBtn,loading:e(o),onClick:a[10]||(a[10]=n=>e(m)())},{default:r(()=>a[14]||(a[14]=[i(" 更新密碼 ")])),_:1},8,["disabled","loading"])]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])]))}}),$e=k({__name:"index",setup(x){const w=I(),{data:u}=V({queryKey:[v.showMe.queryKey],queryFn:()=>v.showMe.api()});return(b,s)=>(y(),z(e(O),{vertical:"",justify:"space-between"},{default:r(()=>{var p,m;return[t(e(D),{title:"個人資料"},j({"header-extra":r(()=>{var o,l;return[i(h((l=(o=e(u))==null?void 0:o.user)!=null&&l.emailVerified?"已驗證":"未驗證"),1)]}),default:r(()=>[t(e(Z),null,{default:r(()=>{var o,l;return[i(h((l=(o=e(u))==null?void 0:o.user)==null?void 0:l.name),1)]}),_:1}),t(e(O),null,{default:r(()=>[t(e(K),{align:"center"},{default:r(()=>[t(e(R),{size:"16"},{default:r(()=>[t(e(ee))]),_:1}),t(e(F),null,{default:r(()=>{var o,l;return[i(h((l=(o=e(u))==null?void 0:o.user)==null?void 0:l.email),1)]}),_:1})]),_:1}),t(e(K),{align:"center"},{default:r(()=>[t(e(R),{size:""},{default:r(()=>[t(e(ne))]),_:1}),t(e(F),null,{default:r(()=>{var o,l;return[i(h((l=(o=e(u))==null?void 0:o.user)==null?void 0:l.role),1)]}),_:1})]),_:1})]),_:1})]),_:2},[(m=(p=e(u))==null?void 0:p.user)!=null&&m.emailVerified?void 0:{name:"action",fn:r(()=>[t(e(N),{type:"primary",strong:"",secondary:"",block:"",size:"small",onClick:s[0]||(s[0]=o=>e(w).push(e(H).profileEmailVerify))},{default:r(()=>s[1]||(s[1]=[i(" 前往驗證 ")])),_:1})]),key:"0"}]),1024),t(de)]}),_:1}))}});export{$e as default};
