import{u as W}from"./useQuery-a3d85d43.js";import{c as L,i as b,a as U,d as P,b as G,u as j,aW as J,e as M,ag as g,f as Q,h as Z,L as $,Z as S,aq as T,aX as X,r as R,S as O,an as V,P as s,O as r,T as f,Q as e,U as _,aN as Y,aO as F,aH as q,aI as x,aJ as y,aY as N,aZ as k,R as ee,M as ae,aG as te,a_ as se,ap as C,$ as K,_ as E,a3 as re}from"./index-1019b754.js";import{u as B}from"./useUserApi-63f8940e.js";import{u as ne}from"./use-message-86b9c1b3.js";import{N as oe,a as de}from"./DrawerContent-2abddfbb.js";import{N as H}from"./text-73ff819c.js";import{N as I}from"./Flex-96acb230.js";const ie=L("h",`
 font-size: var(--n-font-size);
 font-weight: var(--n-font-weight);
 margin: var(--n-margin);
 transition: color .3s var(--n-bezier);
 color: var(--n-text-color);
`,[b("&:first-child",{marginTop:0}),U("prefix-bar",{position:"relative",paddingLeft:"var(--n-prefix-width)"},[U("align-text",{paddingLeft:0},[b("&::before",{left:"calc(-1 * var(--n-prefix-width))"})]),b("&::before",`
 content: "";
 width: var(--n-bar-width);
 border-radius: calc(var(--n-bar-width) / 2);
 transition: background-color .3s var(--n-bezier);
 left: 0;
 top: 0;
 bottom: 0;
 position: absolute;
 `),b("&::before",{backgroundColor:"var(--n-bar-color)"})])]),le=Object.assign(Object.assign({},j.props),{type:{type:String,default:"default"},prefix:String,alignText:Boolean}),h=p=>P({name:`H${p}`,props:le,setup(i){const{mergedClsPrefixRef:u,inlineThemeDisabled:c}=G(i),t=j("Typography","-h",ie,J,i,u),m=M(()=>{const{type:o}=i,{common:{cubicBezierEaseInOut:l},self:{headerFontWeight:z,headerTextColor:d,[g("headerPrefixWidth",p)]:a,[g("headerFontSize",p)]:n,[g("headerMargin",p)]:v,[g("headerBarWidth",p)]:A,[g("headerBarColor",o)]:D}}=t.value;return{"--n-bezier":l,"--n-font-size":n,"--n-margin":v,"--n-bar-color":D,"--n-bar-width":A,"--n-font-weight":z,"--n-text-color":d,"--n-prefix-width":a}}),w=c?Q(`h${p}`,M(()=>i.type[0]),m,i):void 0;return{mergedClsPrefix:u,cssVars:c?void 0:m,themeClass:w==null?void 0:w.themeClass,onRender:w==null?void 0:w.onRender}},render(){var i;const{prefix:u,alignText:c,mergedClsPrefix:t,cssVars:m,$slots:w}=this;return(i=this.onRender)===null||i===void 0||i.call(this),Z(`h${p}`,{class:[`${t}-h`,`${t}-h${p}`,this.themeClass,{[`${t}-h--prefix-bar`]:u,[`${t}-h--align-text`]:c}],style:m},w)}});h("1");const ue=h("2");h("3");h("4");h("5");h("6");const we={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},pe=T("rect",{x:"48",y:"96",width:"416",height:"320",rx:"40",ry:"40",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),me=T("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M112 160l144 112l144-112"},null,-1),ce=[pe,me],fe=P({name:"MailOutline",render:function(i,u){return $(),S("svg",we,ce)}}),he={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ge=T("path",{d:"M344 144c-3.92 52.87-44 96-88 96s-84.15-43.12-88-96c-4-55 35-96 88-96s92 42 88 96z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),Pe=T("path",{d:"M256 304c-87 0-175.3 48-191.64 138.6C62.39 453.52 68.57 464 80 464h352c11.44 0 17.62-10.48 15.65-21.4C431.3 352 343 304 256 304z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),ve=[ge,Pe],be=P({name:"PersonOutline",render:function(i,u){return $(),S("svg",he,ve)}}),{Axios:ze,AxiosError:xe,CanceledError:Re,isCancel:Se,CancelToken:Ue,VERSION:Me,all:Oe,Cancel:Ve,isAxiosError:Fe,spread:qe,toFormData:Ke,AxiosHeaders:Ee,HttpStatusCode:He,formToJSON:Ie,getAdapter:je,mergeConfig:Ae}=X,ye=P({__name:"UpdateProfileBtnComponent",setup(p){const i=R(null),u=R(null),c=ne(),t=R({data:{changePassword:{currentPassword:"",newPassword:"",reenteredNewPassword:""},changeName:{name:""}},status:{drawer:!1},disabled:{updatePasswordBtn:!0,updateNameBtn:!0}}),m={currentPassword:[{required:!0,message:"Password is required"}],newPassword:[{required:!0,message:"新密碼是必填的",trigger:["input","blur"]}],reenteredNewPassword:[{required:!0,message:"確認新密碼是必填的",trigger:["input","blur"]},{message:"新密碼與確認新密碼不一致!",trigger:["input","blur"],validator:()=>t.value.data.changePassword.newPassword===t.value.data.changePassword.reenteredNewPassword}]},{mutate:w,isPending:o}=O({mutationFn:async()=>await B.updatePassword.api({oldPassword:t.value.data.changePassword.currentPassword,newPassword:t.value.data.changePassword.newPassword}),onSuccess:async d=>{var a,n,v;if(d.msg==="Sucess! Password Updated"){c.success("更新密碼成功");return}d instanceof xe&&(((a=d.response)==null?void 0:a.status)===400||((n=d.response)==null?void 0:n.status)===403||((v=d.response)==null?void 0:v.status)===401)&&c.error("更新密碼失敗")}});V(t.value.data.changePassword,()=>{const{data:d}=t.value,a=!!(d.changePassword.currentPassword&&d.changePassword.newPassword&&d.changePassword.reenteredNewPassword&&d.changePassword.reenteredNewPassword===d.changePassword.newPassword);t.value.disabled.updatePasswordBtn=!a});const{mutate:l,isPending:z}=O({mutationFn:async()=>await B.editUserInfo.api({name:t.value.data.changeName.name})});return V(t.value.data.changeName,()=>{const{data:d}=t.value,a=!!d.changeName.name;t.value.disabled.updateNameBtn=!a}),(d,a)=>($(),S("div",null,[s(e(_),{type:"primary",strong:"",block:"",onClick:a[0]||(a[0]=n=>e(t).status.drawer=!0)},{default:r(()=>a[12]||(a[12]=[f(" 編輯個人資料 ")])),_:1}),s(e(de),{show:e(t).status.drawer,"onUpdate:show":a[11]||(a[11]=n=>e(t).status.drawer=n),width:502,height:500,placement:"bottom"},{default:r(()=>[s(e(oe),{title:"Stoner"},{default:r(()=>[s(e(Y),{type:"segment",animated:""},{default:r(()=>[s(e(F),{name:"profile",tab:"更改個人資料"},{default:r(()=>[s(e(q),{ref_key:"nameRef",ref:u,model:e(t).data.changeName},{default:r(()=>[s(e(x),{path:"name",label:"姓名"},{default:r(()=>[s(e(y),{value:e(t).data.changeName.name,"onUpdate:value":a[1]||(a[1]=n=>e(t).data.changeName.name=n),type:"text",onKeydown:a[2]||(a[2]=N(k(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1})]),_:1},8,["model"]),s(e(_),{round:"",type:"primary",loading:e(z),disabled:e(t).disabled.updateNameBtn,onClick:a[3]||(a[3]=n=>e(l)())},{default:r(()=>a[13]||(a[13]=[f(" 更新姓名 ")])),_:1},8,["loading","disabled"])]),_:1}),s(e(F),{name:"password",tab:"更改密碼"},{default:r(()=>[s(e(q),{ref_key:"formRef",ref:i,model:e(t).data.changePassword,rules:m},{default:r(()=>[s(e(x),{path:"currentPassword",label:"現在密碼"},{default:r(()=>[s(e(y),{value:e(t).data.changePassword.currentPassword,"onUpdate:value":a[4]||(a[4]=n=>e(t).data.changePassword.currentPassword=n),type:"password","show-password-on":"click",onKeydown:a[5]||(a[5]=N(k(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1},8,["path"]),s(e(x),{path:"newPassword",label:"新密碼"},{default:r(()=>[s(e(y),{value:e(t).data.changePassword.newPassword,"onUpdate:value":a[6]||(a[6]=n=>e(t).data.changePassword.newPassword=n),type:"password","show-password-on":"click",onKeydown:a[7]||(a[7]=N(k(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1},8,["path"]),s(e(x),{path:"reenteredNewPassword",label:"確認新密碼"},{default:r(()=>[s(e(y),{value:e(t).data.changePassword.reenteredNewPassword,"onUpdate:value":a[8]||(a[8]=n=>e(t).data.changePassword.reenteredNewPassword=n),type:"password","show-password-on":"click",onKeydown:a[9]||(a[9]=N(k(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1},8,["path"]),s(e(_),{round:"",type:"primary",disabled:e(t).disabled.updatePasswordBtn,loading:e(o),onClick:a[10]||(a[10]=n=>e(w)())},{default:r(()=>a[14]||(a[14]=[f(" 更新密碼 ")])),_:1},8,["disabled","loading"])]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])]))}}),De=P({__name:"index",setup(p){const i=ee(),{data:u}=W({queryKey:[B.showMe.queryKey],queryFn:()=>B.showMe.api()});return(c,t)=>($(),ae(e(K),{vertical:"",justify:"space-between"},{default:r(()=>{var m,w;return[s(e(te),{title:"個人資料"},se({"header-extra":r(()=>{var o,l;return[f(C((l=(o=e(u))==null?void 0:o.user)!=null&&l.emailVerified?"已驗證":"未驗證"),1)]}),default:r(()=>[s(e(ue),null,{default:r(()=>{var o,l;return[f(C((l=(o=e(u))==null?void 0:o.user)==null?void 0:l.name),1)]}),_:1}),s(e(K),null,{default:r(()=>[s(e(I),{align:"center"},{default:r(()=>[s(e(E),{size:"16"},{default:r(()=>[s(e(fe))]),_:1}),s(e(H),null,{default:r(()=>{var o,l;return[f(C((l=(o=e(u))==null?void 0:o.user)==null?void 0:l.email),1)]}),_:1})]),_:1}),s(e(I),{align:"center"},{default:r(()=>[s(e(E),{size:""},{default:r(()=>[s(e(be))]),_:1}),s(e(H),null,{default:r(()=>{var o,l;return[f(C((l=(o=e(u))==null?void 0:o.user)==null?void 0:l.role),1)]}),_:1})]),_:1})]),_:1})]),_:2},[(w=(m=e(u))==null?void 0:m.user)!=null&&w.emailVerified?void 0:{name:"action",fn:r(()=>[s(e(_),{type:"primary",strong:"",secondary:"",block:"",size:"small",onClick:t[0]||(t[0]=o=>e(i).push(e(re).profileEmailVerify))},{default:r(()=>t[1]||(t[1]=[f(" 前往驗證 ")])),_:1})]),key:"0"}]),1024),s(ye)]}),_:1}))}});export{De as default};
